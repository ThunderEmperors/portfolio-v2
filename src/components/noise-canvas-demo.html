<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Canvas Noise Animation</title>
  <style>
    body { background: #222; color: #eee; font-family: monospace; }
    #myCanvas { border: 1px solid #888; margin: 2em auto; display: block; }
  </style>
</head>
<body>
  <h2>Canvas Noise Animation</h2>
  <canvas id="myCanvas" width="600" height="220"></canvas>
  <script type="module">
    import { run } from './run.js';

    // Noise function stub
    let noise3D = function() { return 0; };

    const density = 'Ã‘@#W$9876543210?!abcxyz;:+=-,._ ';

    // Load SimplexNoiseJS dynamically and start animation only after loaded
    fetch("https://raw.githubusercontent.com/blindman67/SimplexNoiseJS/master/simplexNoise.js")
      .then(e => e.text())
      .then(e => {
        const openSimplexNoise = new Function("return " + e)();
        noise3D = openSimplexNoise(Date.now()).noise3D;
        // Define main after noise3D is ready
        function main(coord, context, cursor, buffer) {
          const t = context.time * 0.0007;
          const s = 0.03;
          const x = coord.x * s;
          const y = coord.y * s / context.metrics.aspect + t;
          const i = Math.floor((noise3D(x, y, t) * 0.5 + 0.5) * density.length);
          return density[i];
        }
        // Now start the animation
        run({ main }, {
          element: document.getElementById('myCanvas'),
          renderer: 'canvas',
          cols: 60,
          rows: 10,
          color: '#eee',
          backgroundColor: '#222',
          fontFamily: 'monospace',
          fontSize: 18,
          lineHeight: 22,
          fps: 30
        });
      });
  </script>
</body>
</html>
